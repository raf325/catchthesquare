<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Catch the Square ‚Äì Online Leaderboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: radial-gradient(circle at top, #0f172a, #020617);
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .game {
      background: #020617cc;
      padding: 20px;
      border-radius: 12px;
      width: 360px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.5);
    }

    h1 { margin-top: 0; }

    #status {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 14px;
    }

    #field {
      position: relative;
      width: 320px;
      height: 320px;
      background: #020617;
      border: 1px solid #38bdf8;
      border-radius: 10px;
      margin: auto;
      overflow: hidden;
    }

    .target {
      position: absolute;
      background: #22c55e;
      width: 44px;
      height: 44px;
      border-radius: 8px;
      cursor: pointer;
      transition: left .2s, top .2s;
    }

    .bomb {
      position: absolute;
      background: #ef4444;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      transition: left .6s, top .6s;
    }

    button {
      width: 100%;
      margin-top: 10px;
      padding: 10px;
      background: #38bdf8;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }

    input {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      border-radius: 6px;
      border: none;
    }

    ol {
      padding-left: 20px;
    }
  </style>
</head>
<body>

<div class="game">
  <h1>üéØ Catch the Square</h1>

  <div id="status">
    <div>Punkte: <b id="score">0</b></div>
    <div>Zeit: <b id="time">30</b>s</div>
    <div>Level: <b id="level">1</b></div>
  </div>

  <div id="field">
    <div id="square" class="target" style="display:none"></div>
  </div>

  <button id="startBtn">Spiel starten</button>

  <div id="gameOver" style="display:none">
    <h3>üèÅ Game Over</h3>
    <input id="playerName" placeholder="Dein Name">
    <button id="saveScore">Score speichern</button>
  </div>

  <h3>üèÜ Leaderboard</h3>
  <ol id="leaderboard"></ol>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getFirestore, collection, addDoc,
    query, orderBy, limit, onSnapshot, serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // üîë Firebase Config (dein Projekt)
  const firebaseConfig = {
    apiKey: "AIzaSyA90J97sqt1oMnYfojDEVCKgVBkN_3Ilmc",
    authDomain: "chasethesquare.firebaseapp.com",
    projectId: "chasethesquare",
    storageBucket: "chasethesquare.firebasestorage.app",
    messagingSenderId: "730109083472",
    appId: "1:730109083472:web:f52ccc4f46459e6609f655"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // DOM
  const field = document.getElementById("field");
  const square = document.getElementById("square");
  const scoreEl = document.getElementById("score");
  const timeEl = document.getElementById("time");
  const levelEl = document.getElementById("level");
  const leaderboardEl = document.getElementById("leaderboard");

  let score = 0, time = 30, level = 1;
  let speed = 1000;
  let gameInterval, timerInterval;
  let bombs = [];

  function randomPos(el) {
    el.style.left = Math.random() * (320 - el.offsetWidth) + "px";
    el.style.top = Math.random() * (320 - el.offsetHeight) + "px";
  }

  function placeSquare(resetCombo = false) {
    randomPos(square);
    clearInterval(gameInterval);
    gameInterval = setInterval(() => placeSquare(true), speed);
  }

  function createBombs() {
    bombs.forEach(b => b.remove());
    bombs = [];
    for (let i = 0; i < 3; i++) {
      const b = document.createElement("div");
      b.className = "bomb";
      randomPos(b);
      b.onclick = () => {
        score = Math.max(0, score - 5);
        scoreEl.textContent = score;
      };
      field.appendChild(b);
      bombs.push(b);
    }
    setInterval(() => bombs.forEach(b => randomPos(b)), 2000);
  }

  square.onclick = () => {
    score++;
    scoreEl.textContent = score;
    if (score % 10 === 0) {
      level++;
      levelEl.textContent = level;
      speed = Math.max(300, speed - 100);
    }
    placeSquare();
  };

  document.getElementById("startBtn").onclick = () => {
    score = 0; time = 30; level = 1; speed = 1000;
    scoreEl.textContent = 0;
    timeEl.textContent = 30;
    levelEl.textContent = 1;
    square.style.display = "block";
    document.getElementById("gameOver").style.display = "none";
    placeSquare();
    createBombs();

    timerInterval = setInterval(() => {
      time--;
      timeEl.textContent = time;
      if (time <= 0) endGame();
    }, 1000);
  };

  function endGame() {
    clearInterval(timerInterval);
    clearInterval(gameInterval);
    square.style.display = "none";
    bombs.forEach(b => b.remove());
    document.getElementById("gameOver").style.display = "block";
  }

  document.getElementById("saveScore").onclick = async () => {
    const name = document.getElementById("playerName").value || "Player";
    await addDoc(collection(db, "leaderboard"), {
      name,
      score,
      createdAt: serverTimestamp()
    });
    document.getElementById("playerName").value = "";
  };

  const q = query(
    collection(db, "leaderboard"),
    orderBy("score", "desc"),
    limit(10)
  );

  onSnapshot(q, snap => {
    leaderboardEl.innerHTML = "";
    snap.forEach(doc => {
      const d = doc.data();
      const li = document.createElement("li");
      li.textContent = `${d.name}: ${d.score}`;
      leaderboardEl.appendChild(li);
    });
  });
</script>

</body>
</html>
